<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Cambiar contraseña</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
    :root{
      --bg:#f5f7fb; --card:#ffffff; --ink:#0f172a; --muted:#64748b;
      --brand:#1e40af; --brand-2:#2563eb; --ring:#e5e7eb; --radius:16px;
    }
    *{ box-sizing:border-box }
    html,body{ margin:0; padding:0; background:var(--bg); color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; }
    a{ color:var(--brand-2); text-decoration:none } a:hover{ text-decoration:underline }
    .wrap{ min-height:100dvh; display:grid; place-items:center; padding:24px; }
    .card{
      width:100%; max-width:420px; background:var(--card); border-radius:var(--radius);
      border:1px solid var(--ring);
      box-shadow:0 1px 2px rgba(15,23,42,.06), 0 6px 14px rgba(2,6,23,.04);
      padding:22px 18px;
    }
    .head{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px; }
    .head h1{ margin:0; font-size:20px }
    .muted{ color:var(--muted); font-size:13px; margin-bottom:14px }

    label{ font-size:12px; color:var(--muted); display:block; margin:8px 2px 6px }
    .in{
      width:100%; min-height:40px; padding:10px 12px; border-radius:10px;
      border:1px solid var(--ring); background:#fff; color:var(--ink);
    }
    .in:focus{ outline:none; border-color:#b5c8ff; box-shadow:0 0 0 3px rgba(37,99,235,.15); }
    .pass-wrap{ position:relative }
    .toggle{
      position:absolute; right:8px; top:50%; transform:translateY(-50%);
      border:1px solid var(--ring); background:#fff; color:var(--muted);
      border-radius:8px; padding:4px 8px; cursor:pointer; font-size:12px;
    }

    .btn{
      width:100%; min-height:42px; padding:10px 12px; border-radius:10px; cursor:pointer;
      border:1px solid var(--brand-2); background:var(--brand-2); color:#fff; font-weight:700;
      margin-top:12px;
    }
    .row{ display:flex; justify-content:space-between; gap:10px; margin-top:10px; }
    .btn-outline{
      flex:1; min-height:40px; padding:10px 12px; border-radius:10px; text-align:center;
      border:1px solid var(--ring); background:#fff; color:var(--brand-2); font-weight:700;
    }

    /* flashes */
    .flashes{ margin:6px 0 0 0; }
    .flash{
      border-radius:10px; padding:8px 10px; font-size:13px; margin-top:8px;
      border:1px solid var(--ring);
    }
    .flash.success{ background:#e9f9f2; color:#0d7a5a; border-color:#cfeee1; }
    .flash.error{ background:#ffe4e4; color:#8a1a1a; border-color:#f7c2c2; }
    .flash.info{ background:#eef2ff; color:#1e3a8a; border-color:#d8defe; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <h1>Cambiar contraseña</h1>
        <!-- Volver según rol: si venís desde transportista, vuelve allí; si no, al panel admin -->
        <a class="btn-outline"
          href="{{ url_for('transportista_panel') if session.get('tipo')=='transportista'
                  else (url_for('arenera_panel') if session.get('tipo')=='arenera'
                        else url_for('admin_panel')) }}">
          Inicio
        </a>

      </div>

      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flashes">
          {% for category, message in messages %}
            <div class="flash {{ 'success' if category in ['ok','success'] else ('error' if category in ['error','danger'] else 'info') }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
      {% endwith %}

      <form method="post" action="{{ url_for('change_password') }}">
        <label for="cur">Contraseña actual</label>
        <div class="pass-wrap">
          <input id="cur" class="in" type="password" name="current_password" placeholder="Actual" required>
          <button class="toggle" type="button" onclick="togglePass('cur', this)">Ver</button>
        </div>

        <label for="new">Nueva contraseña</label>
        <div class="pass-wrap">
          <input id="new" class="in" type="password" name="new_password" placeholder="Nueva" required>
          <button class="toggle" type="button" onclick="togglePass('new', this)">Ver</button>
        </div>

        <button class="btn" type="submit">Actualizar</button>
      </form>
    </div>
  </div>

  <script>
    function togglePass(id, btn){
      const el = document.getElementById(id);
      const is = el.type === 'password';
      el.type = is ? 'text' : 'password';
      btn.textContent = is ? 'Ocultar' : 'Ver';
      el.focus();
    }
  </script>
</body>
</html>
