<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestionar {{ transportista.username }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial,sans-serif; margin:0; background:#f5f5f5;}
    .container { max-width:800px; margin:24px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1);}
    h1,h2 { text-align:center; color:#007bff; }
    .flash-messages { text-align:center; margin:15px 0;}
    .flash-messages p { padding:10px; background:#d4edda; color:#155724; border:1px solid #c3e6cb; border-radius:5px; }
    form { text-align:center; margin-bottom:18px;}
    select, input { margin:5px; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:15px;}
    button { padding:9px 16px; background:#17a2b8; color:white; border:none; border-radius:4px; cursor:pointer; font-size:15px;}
    button:hover { background:#138496;}
    ul { list-style:none; padding:0;}
    li { margin:10px 0; padding:15px; background:#fff; border:1px solid #e9ecef; border-radius:8px;}
    .user-info { font-weight:bold; font-size:16px; color:#495057;}
    .stats { color:#6c757d; margin:5px 0;}
    .back { text-align:center; margin-top:20px;}
    .back a { text-decoration:none; color:#007bff; padding:8px 15px; background:#f1f1f1; border-radius:5px;}
    .back a:hover { background:#e3e3e3;}
    @media (max-width:600px) {
      .container { padding:5px;}
      h1, h2 { font-size:18px;}
      select, input, button { font-size:13px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>⚙️ Gestionar: {{ transportista.username }}</h1>
    {% with msgs = get_flashed_messages() %}
      {% if msgs %}
        <div class="flash-messages">
          {% for m in msgs %}<p>{{ m }}</p>{% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    <h2>Nueva Asignación Diaria</h2>
    <form action="" method="POST">
      <select name="arenera" required>
        {% for ar in areneras %}
          <option value="{{ ar.id }}">{{ ar.username }}</option>
        {% endfor %}
      </select>
      <input type="number" name="daily_limit" placeholder="Cupos diarios" min="0" required>
      <button type="submit">Guardar</button>
    </form>
    <h2>Asignaciones Actuales</h2>
    <ul>
      {% for a in assignments %}
        <li>
          <div class="user-info">{{ a.arenera.username }}</div>
          <div class="stats">
            Cupo diario: {{ a.daily_limit }} |
            Hoy usados: {{ stats[a.id].en_viaje + stats[a.id].llegados + stats[a.id].cancelados }} |
            Llegados: {{ stats[a.id].llegados }} |
            En viaje: {{ stats[a.id].en_viaje }} |
            Cancelados: {{ stats[a.id].cancelados }}
          </div>
        </li>
      {% else %}
        <li style="text-align:center; color:#6c757d;">Sin asignaciones</li>
      {% endfor %}
    </ul>
    <div class="back">
      <a href="{{ url_for('admin_panel') }}">← Volver al panel</a>
    </div>
  </div>
</body>
</html>
