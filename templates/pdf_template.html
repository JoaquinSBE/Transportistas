<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <style>
        @page {
            size: A4 landscape;
            margin: 1cm;
            /* Sin @bottom-center para máxima compatibilidad */
        }

        body {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 10pt;
            color: #000;
            line-height: 1.4; /* Más espacio entre líneas de texto */
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
        }

        /* Celdas Generales: Más padding para evitar solapamiento */
        td { 
            padding: 6px 8px; 
            vertical-align: middle;
        }

        /* TÍTULO PRINCIPAL */
        .header-box {
            background-color: #d9d9d9;
            border: 1px solid #000;
            text-align: center;
            font-weight: bold;
            font-size: 12pt;
            padding: 8px;
            margin-bottom: 5px;
        }

        /* TABLAS DE DATOS (Cabecera y Periodo) */
        .data-table td {
            border: 1px solid #000;
        }
        
        .gray-bg { 
            background-color: #d9d9d9; 
            font-weight: bold; 
            text-align: center;
        }
        
        .yellow-bg {
            background-color: #ffff00;
            text-align: center;
        }

        /* SECCIÓN DESCRIPCIÓN (TOTALES) */
        .desc-title {
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 11pt;
        }
        
        .total-table {
            width: 100%;
            margin-bottom: 20px;
        }
        
        /* Filas de totales con altura mínima para no solaparse */
        .total-row td {
            padding-top: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid #000;
        }
        
        .total-label { text-align: left; }
        .total-value { text-align: right; font-weight: bold; }
        
        /* Fila Final (Total a Facturar) */
        .final-row td {
            padding-top: 10px;
            padding-bottom: 10px;
            font-weight: bold;
            font-size: 11pt;
            border-bottom: 2px solid #000; /* Cierre visual fuerte */
        }

        /* TABLA DETALLE */
        .detail-title-box {
            background-color: #d9d9d9;
            border: 1px solid #000;
            text-align: center;
            font-weight: bold;
            font-size: 10pt;
            padding: 4px;
            border-bottom: none; /* Se une con la tabla */
        }

        .detail-table td {
            border: 1px solid #000;
            font-size: 9pt;
            text-align: center;
            padding: 5px;
        }
        
        .detail-header td {
            background-color: #f2f2f2; /* Gris muy suave para header detalle */
            font-weight: bold;
        }
        
        .text-right { text-align: right !important; padding-right: 8px !important; }
        .text-left { text-align: left !important; padding-left: 8px !important; }

    </style>
</head>
<body>

    <div class="header-box">Certificado de Toneladas Transportadas</div>

    <table class="data-table" style="margin-bottom: 5px;">
        <tr>
            <td width="60%" class="gray-bg">Fecha Emisión</td>
            <td width="40%" style="text-align: center;">{{ fecha_emision }}</td>
        </tr>
        <tr>
            <td class="gray-bg">Empresa de Transporte</td>
            <td style="text-align: center;">{{ empresa }}</td>
        </tr>
    </table>

    <table class="data-table" style="margin-bottom: 10px;">
        <tr>
            <td width="60%" rowspan="2" class="gray-bg" style="vertical-align: middle;">Período Certificado</td>
            <td width="15%" class="gray-bg">Desde</td>
            <td width="25%" style="text-align: center;">{{ periodo_inicio }}</td>
        </tr>
        <tr>
            <td class="gray-bg">Hasta</td>
            <td style="text-align: center;">{{ periodo_fin }}</td>
        </tr>
    </table>

    <div class="desc-title">Descripción</div>
    
    <table class="total-table">
        <tr class="total-row">
            <td class="total-label">Toneladas Transportadas (Tn)</td>
            <td class="total-value">{{ "%.2f"|format(total_tn) }}</td>
        </tr>
        <tr class="total-row">
            <td class="total-label">Valor Tarifa Flete (Arg. $/Tn)</td>
            <td class="total-value">$ {{ "{:,.2f}".format(precio_unitario) }}</td>
        </tr>
        <tr class="total-row">
            <td class="total-label">Sub total transportado (Arg. $)</td>
            <td class="total-value">$ {{ "{:,.2f}".format(subtotal) }}</td>
        </tr>
        
        <tr class="total-row">
            <td class="total-label">Débitos Aplicados (Tn)</td>
            <td class="total-value">{{ "%.2f"|format(tn_merma) }}</td>
        </tr>
        
        <tr class="total-row">
            <td class="total-label">Valor arena a descontar (Arg. $)</td>
            <td class="total-value" style="color: #b91c1c;">$ {{ "{:,.2f}".format(descuento_dinero) }}</td>
        </tr>

        <tr class="final-row">
            <td class="total-label">TOTAL A FACTURAR (Arg. $)</td>
            <td class="total-value">$ {{ "{:,.2f}".format(total_neto) }}</td>
        </tr>
    </table>

    <div class="detail-title-box">Detalle</div>
    
    <table class="detail-table" cellspacing="0" cellpadding="0">
        <tr class="detail-header">
            <td width="12%">Remito</td>
            <td width="12%">Fecha desp</td>
            <td width="24%">Chofer</td>
            <td width="14%">Tractor</td>
            <td width="12%">Fecha recep</td>
            <td width="13%">Ton neto recib.</td>
            <td width="13%">Fecha certif</td>
        </tr>
        {% for item in items %}
        <tr>
            <td>{{ item.remito }}</td>
            <td>{{ item.f_salida }}</td>
            <td class="text-left">{{ item.chofer }}</td>
            <td>{{ item.patente }}</td>
            <td>{{ item.f_llegada }}</td>
            <td class="text-right">{{ "%.2f"|format(item.peso) }}</td>
            <td>{{ item.f_certif }}</td>
        </tr>
        {% endfor %}
    </table>

</body>
</html>