<!doctype html>
<html lang="es" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <title>Vista Previa y Env铆o</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f3f4f6; height: 100vh; display: flex; flex-direction: column; }
    .preview-container { flex: 1; display: flex; gap: 20px; padding: 20px; height: calc(100vh - 60px); }
    .pdf-box { flex: 2; background: #525659; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .action-box { flex: 1; background: white; border-radius: 8px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow-y: auto; }
    iframe { width: 100%; height: 100%; border: none; }
  </style>
</head>
<body>

<nav class="navbar navbar-light bg-white border-bottom px-4">
  <span class="navbar-brand mb-0 h1"> Enviar Liquidaci贸n</span>
  <button onclick="window.close()" class="btn btn-outline-secondary btn-sm">Cerrar</button>
</nav>

<div class="preview-container">
    <div class="pdf-box">
        <iframe src="{{ pdf_url }}"></iframe>
    </div>

    <div class="action-box">
        <h5 class="mb-3">Detalles del Env铆o</h5>
        
        <form action="{{ url_for('send_email_action') }}" method="POST">
            <input type="hidden" name="target_id" value="{{ target_id }}">
            <input type="hidden" name="target_type" value="{{ target_type }}">
            <input type="hidden" name="start" value="{{ start }}">
            <input type="hidden" name="end" value="{{ end }}">
            <input type="hidden" name="mode" value="{{ mode }}">

            <div class="mb-3">
                <label class="form-label small fw-bold text-muted">Destinatario</label>
                <input type="email" name="email_dest" class="form-control" value="{{ user.email }}" required>
                {% if not user.email %}
                    <div class="text-danger small mt-1">锔 Este usuario no tiene email configurado.</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label class="form-label small fw-bold text-muted">Asunto</label>
                <input type="text" name="subject" class="form-control" value="Liquidaci贸n de Servicios - {{ user.username }}" required>
            </div>

            <div class="mb-4">
                <label class="form-label small fw-bold text-muted">Mensaje</label>
                <textarea name="body" class="form-control" rows="5">Hola {{ user.username }},

Adjuntamos la liquidaci贸n correspondiente al periodo seleccionado.

Saludos,
Administraci贸n SBE.</textarea>
            </div>

            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-success" {{ 'disabled' if not user.email }}>
                    <i class="fa-solid fa-paper-plane me-2"></i>Enviar por Email
                </button>
                <a href="{{ pdf_url }}" download class="btn btn-primary">
                    <i class="fa-solid fa-download me-2"></i>Descargar PDF
                </a>
            </div>
        </form>
    </div>
</div>

</body>
</html>